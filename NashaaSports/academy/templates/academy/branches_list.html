{% extends 'base.html' %}
{% block content %}
<div class="">
    <div class="flex justify-center md:pt-40">
        <h1 class="text-4xl self-center">الفروع</h1>
    </div>
    <!-- end of header -->

    <div class="flex flex-wrap justify-center mt-11 md:justify-center gap-5">
        {% for branch in branches %}
        <div id="branch-card-{{ branch.id }}">
            <div class="md:w-[15rem] md:h-[16rem] p-6 bg-white border border-gray-200 rounded-lg shadow hover:scale-110 duration-300 ease-linear">
                <i class="fa-solid fa-city text-gray-500 text-4xl"></i>
                <a href="#">
                    <h5 class="mb-2 text-2xl font-semibold tracking-tight text-gray-900">{{ branch.branch_name }}</h5>
                </a>
                <p class="font-normal text-gray-500">السجل التجاري: <span class="text-xs">{{ branch.register_no }}</span></p>
                <p class="font-normal text-gray-500">عدد البرامج: {{ branch.program_set.count }}</p>
                <p class="mb-3 font-normal text-gray-500">{{ branch.branch_city }}</p>
                <div class="flex justify-between">
                    <a href="#" class="inline-flex font-medium items-center text-blue-600 hover:underline">عرض البرامج</a>
                    <div class="flex items-center">
                        <a href="{% url 'academy:update_branch_view' branch.id %}"><span class="material-symbols-outlined">edit</span></a>
                        <button data-branch-id="{{ branch.id }}" class="open-popup-btn">
                            <span class="material-symbols-outlined hover:text-red-600">delete</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Loop through each branch to generate popups -->
    {% for branch in branches %}
    <div id="popup-{{ branch.id }}" class="popup hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white rounded-lg p-8 shadow-lg w-full max-w-md">
            <h2 class="text-xl font-semibold mb-4">هل انت متاكد من حذف {{ branch.branch_name }}؟<br><span class="text-sm text-gray-400">سوف يتم حذف جميع البرامج المتعلقة بهذا الفرع</span></h2>
            <button class="close-popup-btn bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none"><a href="">لا</a></button>
            <a href="{% url 'academy:delete_branch_view' branch.id %}?next={{request.path}}"><button class="close-popup-btn bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 focus:outline-none">نعم</button></a>
        </div>
    </div>
    {% endfor %}

    <script>
        // Handle opening popups and hiding cards
        document.querySelectorAll('.open-popup-btn').forEach(button => {
            button.addEventListener('click', () => {
                const branchId = button.getAttribute('data-branch-id');
                document.getElementById(`popup-${branchId}`).classList.remove('hidden');
                document.getElementById(`branch-card-${branchId}`).classList.add('hidden');
            });
        });

        // Handle closing popups
        document.querySelectorAll('.close-popup-btn').forEach(button => {
            button.addEventListener('click', () => {
                const popup = button.closest('.popup');
                popup.classList.add('hidden');
                
                const branchId = popup.id.split('-')[1];
                document.getElementById(`branch-card-${branchId}`).classList.remove('hidden');
            });
        });

        // Optional: Close popup when clicking outside the content
        document.querySelectorAll('.popup').forEach(popup => {
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    popup.classList.add('hidden');

                    const branchId = popup.id.split('-')[1];
                    document.getElementById(`branch-card-${branchId}`).classList.remove('hidden');
                }
            });
        });
    </script>
{% endblock %}
